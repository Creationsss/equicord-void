<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Void Repository - Test</title>
		<style>
			body {
				font-family: monospace;
				line-height: 1.8;
				padding: 2rem;
				color: #222;
				background: #fff;
			}
			pre {
				margin: 0.5rem 0 1.5rem;
				white-space: pre-wrap;
			}
			.pkg { display: block; }
			.ver-ok { color: #2a2; }
			.ver-update { color: #c80; }
			.ver-error { color: #888; }
			@media (prefers-color-scheme: dark) {
				body {
					color: #ddd;
					background: #111;
				}
				.ver-ok { color: #5b5; }
				.ver-update { color: #eb4; }
			}
		</style>
	</head>
	<body>
		<pre>
Version Checker Test
====================

<span id="pkglist"><span class='pkg' data-repo='multimedia/audiocd-kio' data-version='25.12.2' data-tag-prefix='v' data-api='gitlab' data-api-url='https://invent.kde.org'>  audiocd-kio 25.12.2_1 - KIO worker for accessing audio CDs</span>
<span class='pkg' data-repo='bitwarden/clients' data-version='2025.1.0' data-tag-prefix='desktop-v' data-api='github'>  bitwarden 2025.1.0_1 - Secure and free password manager - desktop client</span>
<span class='pkg' data-repo='usebruno/bruno' data-version='3.1.1' data-tag-prefix='v' data-api='github'>  bruno 3.1.1_1 - Opensource IDE for exploring and testing APIs</span>
<span class='pkg' data-repo='cinnyapp/cinny-desktop' data-version='4.10.3' data-tag-prefix='v' data-api='github'>  cinny 4.10.3_1 - Yet another matrix client for desktop</span>
<span class='pkg' data-repo='Equicord/Equibop' data-version='3.1.8' data-tag-prefix='v' data-api='github'>  equibop 3.1.8_3 - Custom Discord App for better performance and improved Linux support</span>
<span class='pkg' data-repo='benjamimgois/goverlay' data-version='1.7.4' data-tag-prefix='' data-api='github'>  goverlay 1.7.4_1 - Easy graphical interface to configure MangoHud, vkBasalt, and OptiScaler</span>
<span class='pkg' data-repo='creations/grabit' data-version='1.1.4' data-tag-prefix='v' data-api='gitlab' data-api-url='https://heliopolis.live'>  grabit 1.1.4_1 - Screenshot, screen recording, and file uploader with OCR support</span>
<span class='pkg' data-repo='imputnet/helium-linux' data-version='0.9.2.1' data-tag-prefix='' data-api='github'>  helium 0.9.2.1_1 - Chromium-based Helium browser - portable Linux packaging</span>
<span class='pkg' data-repo='Heroic-Games-Launcher/HeroicGamesLauncher' data-version='2.19.1' data-tag-prefix='v' data-api='github'>  heroic 2.19.1_1 - Open source launcher for GOG, Epic Games and Amazon Games</span>
<span class='pkg' data-repo='Nokse22/high-tide' data-version='1.0.0' data-tag-prefix='v' data-api='github'>  high-tide 1.0.0_1 - Libadwaita TIDAL client for Linux</span>
<span class='pkg' data-repo='multimedia/libkcompactdisc' data-version='25.12.2' data-tag-prefix='v' data-api='gitlab' data-api-url='https://invent.kde.org'>  libkcompactdisc 25.12.2_1 - Library for interfacing with CDs</span>
<span class='pkg' data-repo='localsend/localsend' data-version='1.17.0' data-tag-prefix='v' data-api='github'>  localsend 1.17.0_1 - Open source cross-platform alternative to AirDrop</span>
<span class='pkg' data-repo='nowrep/obs-vkcapture' data-version='1.5.3' data-tag-prefix='v' data-api='github'>  obs-vkcapture 1.5.3_2 - OBS plugin for Vulkan/OpenGL game capture on Linux</span>
<span class='pkg' data-repo='OpenRGB/OpenRGB' data-version='1.0rc2' data-tag-prefix='release_candidate_' data-api='codeberg'>  openrgb 1.0rc2_1 - Open source RGB lighting control that doesn't depend on manufacturer software</span>
<span class='pkg' data-repo='Mastermindzh/tidal-hifi' data-version='5.0.0' data-tag-prefix='' data-api='github'>  tidal-hifi 5.0.0_1 - Web version of Tidal running in electron with hifi support thanks to widevine</span>
</span></pre>
	</body>
	<script>
		(function () {
			var CACHE_KEY = "void-repo-versions";
			var CACHE_TTL = 3600000;
			var cache = {};

			try {
				var stored = JSON.parse(localStorage.getItem(CACHE_KEY));
				if (stored && Date.now() - stored.ts < CACHE_TTL) {
					cache = stored.data;
				}
			} catch (e) {}

			var pkgs = document.querySelectorAll(".pkg[data-repo]");
			var pending = 0;

			for (var i = 0; i < pkgs.length; i++) {
				checkVersion(pkgs[i]);
			}

			function saveCache() {
				try {
					localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), data: cache }));
				} catch (e) {}
			}

			function checkVersion(el) {
				var repo = el.getAttribute("data-repo");
				var current = el.getAttribute("data-version");
				var prefix = el.getAttribute("data-tag-prefix") || "";
				var api = el.getAttribute("data-api") || "github";
				var apiUrl = el.getAttribute("data-api-url") || "";

				if (!repo) return;

				if (cache[repo]) {
					showResult(el, current, cache[repo]);
					return;
				}

				var url;
				if (api === "gitlab") {
					url = apiUrl + "/api/v4/projects/" + encodeURIComponent(repo) + "/repository/tags";
				} else if (api === "codeberg") {
					url = "https://codeberg.org/api/v1/repos/" + repo + "/releases/latest";
				} else if (prefix === "desktop-v") {
					url = "https://api.github.com/repos/" + repo + "/releases";
				} else {
					url = "https://api.github.com/repos/" + repo + "/releases/latest";
				}

				pending++;
				fetch(url)
					.then(function (r) { return r.json(); })
					.then(function (data) {
						var tag;
						if (api === "gitlab" && Array.isArray(data) && data.length > 0) {
							tag = data[0].name;
						} else if (prefix === "desktop-v" && Array.isArray(data)) {
							for (var j = 0; j < data.length; j++) {
								if (data[j].tag_name && data[j].tag_name.indexOf("desktop-v") === 0) {
									tag = data[j].tag_name;
									break;
								}
							}
						} else {
							tag = data.tag_name;
						}

						if (!tag) {
							appendStatus(el, "?", "ver-error");
							return;
						}

						var latest = tag;
						if (prefix && latest.indexOf(prefix) === 0) {
							latest = latest.substring(prefix.length);
						}

						cache[repo] = latest;
						showResult(el, current, latest);
					})
					.catch(function () {
						appendStatus(el, "?", "ver-error");
					})
					.finally(function () {
						if (--pending <= 0) saveCache();
					});
			}

			function showResult(el, current, latest) {
				if (latest === current) {
					appendStatus(el, "up to date", "ver-ok");
				} else {
					appendStatus(el, latest + " available", "ver-update");
				}
			}

			function appendStatus(el, text, cls) {
				var span = document.createElement("span");
				span.className = cls;
				span.textContent = " [" + text + "]";
				el.appendChild(span);
			}
		})();
	</script>
</html>
