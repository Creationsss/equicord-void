<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Void Repository</title>
		<style>
			* { margin: 0; padding: 0; box-sizing: border-box; }
			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
				line-height: 1.6;
				color: #24292f;
				background: #fff;
			}
			.container {
				max-width: 960px;
				margin: 0 auto;
				padding: 3rem 1.5rem;
			}
			h1 {
				font-size: 1.4rem;
				font-weight: 600;
				padding-bottom: 0.6rem;
				border-bottom: 1px solid #d0d7de;
				margin-bottom: 0.4rem;
			}
			.subtitle {
				color: #656d76;
				font-size: 0.9rem;
				margin-bottom: 1.5rem;
			}
			h2 {
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				color: #656d76;
				margin-bottom: 0.4rem;
			}
			.section { margin-bottom: 1.5rem; }
			.cmd {
				display: block;
				font-family: ui-monospace, "SFMono-Regular", "SF Mono", Menlo, Consolas, monospace;
				font-size: 0.85rem;
				background: #f6f8fa;
				border: 1px solid #d0d7de;
				padding: 0.5rem 0.7rem;
				margin-bottom: 0.4rem;
				overflow-x: auto;
				white-space: pre;
			}
			.cmd-label {
				display: block;
				font-size: 0.8rem;
				color: #656d76;
				margin-bottom: 0.15rem;
			}
			a { color: #0969da; text-decoration: none; }
			a:hover { text-decoration: underline; }
			.source { font-size: 0.85rem; color: #656d76; }
			#search {
				display: block;
				font-family: ui-monospace, "SFMono-Regular", "SF Mono", Menlo, Consolas, monospace;
				font-size: 0.85rem;
				padding: 0.5rem 0.7rem;
				border: 1px solid #d0d7de;
				background: #f6f8fa;
				color: inherit;
				outline: none;
				width: 100%;
				margin-bottom: 0.4rem;
			}
			#search:focus { border-color: #0969da; }
			#pkglist {
				font-family: ui-monospace, "SFMono-Regular", "SF Mono", Menlo, Consolas, monospace;
				font-size: 0.85rem;
				line-height: 1.8;
				overflow-x: auto;
			}
			.pkg { display: block; white-space: nowrap; }
			.pkg.hidden { display: none; }
			.ver-ok { color: #1a7f37; font-size: 0.8em; }
			.ver-update { color: #bf8700; font-size: 0.8em; }
			.ver-error { color: #656d76; font-size: 0.8em; }
			@media (prefers-color-scheme: dark) {
				body { color: #c9d1d9; background: #0d1117; }
				h1 { border-bottom-color: #30363d; }
				.subtitle, h2, .cmd-label, .source { color: #8b949e; }
				.cmd { background: #161b22; border-color: #30363d; }
				a { color: #58a6ff; }
				#search { background: #161b22; border-color: #30363d; color: #c9d1d9; }
				#search:focus { border-color: #58a6ff; }
				.ver-ok { color: #3fb950; }
				.ver-update { color: #d29922; }
				.ver-error { color: #8b949e; }
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Void Repository</h1>
			<p class="subtitle">A third-party Void Linux binary package repository.</p>

			<div class="section">
				<h2>Setup</h2>
				<span class="cmd-label">Add the repository:</span>
				<code class="cmd">echo "repository=https://void.creations.works" | sudo tee /etc/xbps.d/creations.conf</code>
				<span class="cmd-label">Install a package:</span>
				<code class="cmd">sudo xbps-install -S &lt;package&gt;</code>
				<span class="cmd-label">Update all packages:</span>
				<code class="cmd">sudo xbps-install -Su</code>
			</div>

			<div class="section">
				<p class="source">Source: <a href="https://github.com/Creationsss/void-repository">github.com/Creationsss/void-repository</a></p>
			</div>

			<div class="section">
				<h2>Packages</h2>
				<input type="text" id="search" placeholder="search..." autocomplete="off" />
				<div id="pkglist">
<!-- PACKAGES -->
				</div>
			</div>
		</div>
	</body>
	<script>
		document.getElementById("search").addEventListener("input", function () {
			var q = this.value.toLowerCase();
			var pkgs = document.querySelectorAll(".pkg");
			for (var i = 0; i < pkgs.length; i++) {
				pkgs[i].classList.toggle("hidden", q && pkgs[i].textContent.toLowerCase().indexOf(q) === -1);
			}
		});

		(function () {
			var CACHE_KEY = "void-repo-versions";
			var CACHE_TTL = 3600000;
			var cache = {};

			try {
				var stored = JSON.parse(localStorage.getItem(CACHE_KEY));
				if (stored && Date.now() - stored.ts < CACHE_TTL) {
					cache = stored.data;
				}
			} catch (e) {}

			var pkgs = document.querySelectorAll(".pkg[data-repo]");
			var pending = 0;

			for (var i = 0; i < pkgs.length; i++) {
				checkVersion(pkgs[i]);
			}

			function saveCache() {
				try {
					localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), data: cache }));
				} catch (e) {}
			}

			function checkVersion(el) {
				var repo = el.getAttribute("data-repo");
				var current = el.getAttribute("data-version");
				var prefix = el.getAttribute("data-tag-prefix") || "";
				var api = el.getAttribute("data-api") || "github";
				var apiUrl = el.getAttribute("data-api-url") || "";

				if (!repo) return;

				if (cache[repo]) {
					showResult(el, current, cache[repo]);
					return;
				}

				var url;
				if (api === "gitlab") {
					url = apiUrl + "/api/v4/projects/" + encodeURIComponent(repo) + "/repository/tags";
				} else if (api === "codeberg") {
					url = "https://codeberg.org/api/v1/repos/" + repo + "/releases/latest";
				} else if (prefix === "desktop-v") {
					url = "https://api.github.com/repos/" + repo + "/releases";
				} else {
					url = "https://api.github.com/repos/" + repo + "/releases/latest";
				}

				pending++;
				fetch(url)
					.then(function (r) { return r.json(); })
					.then(function (data) {
						var tag;
						if (api === "gitlab" && Array.isArray(data) && data.length > 0) {
							tag = data[0].name;
						} else if (prefix === "desktop-v" && Array.isArray(data)) {
							for (var j = 0; j < data.length; j++) {
								if (data[j].tag_name && data[j].tag_name.indexOf("desktop-v") === 0) {
									tag = data[j].tag_name;
									break;
								}
							}
						} else {
							tag = data.tag_name;
						}

						if (!tag) {
							appendStatus(el, "?", "ver-error");
							return;
						}

						var latest = tag;
						if (prefix && latest.indexOf(prefix) === 0) {
							latest = latest.substring(prefix.length);
						}

						cache[repo] = latest;
						showResult(el, current, latest);
					})
					.catch(function () {
						appendStatus(el, "?", "ver-error");
					})
					.finally(function () {
						if (--pending <= 0) saveCache();
					});
			}

			function showResult(el, current, latest) {
				if (latest === current) {
					appendStatus(el, "up to date", "ver-ok");
				} else {
					appendStatus(el, latest + " available", "ver-update");
				}
			}

			function appendStatus(el, text, cls) {
				var span = document.createElement("span");
				span.className = cls;
				span.textContent = " [" + text + "]";
				el.appendChild(span);
			}
		})();
	</script>
</html>
