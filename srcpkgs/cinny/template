# Template file for 'cinny'
pkgname=cinny
version=4.10.3
revision=1
archs="x86_64"
create_wrksrc=yes
short_desc="Yet another matrix client for desktop"
maintainer="creations <creations@creations.works>"
license="AGPL-3.0-or-later"
homepage="https://github.com/cinnyapp/cinny-desktop"
distfiles="https://github.com/cinnyapp/cinny-desktop/releases/download/v${version}/Cinny_desktop-x86_64.AppImage"
checksum=0216f00cbe29f71a3742b45a6afa8672bf1dbe6d43d4559405c68236b9243a1c
nostrip=yes
allow_unknown_shlibs=yes

do_extract() {
	local _appimage="${XBPS_SRCDISTDIR}/${pkgname}-${version}/Cinny_desktop-x86_64.AppImage"
	chmod +x "$_appimage"
	"$_appimage" --appimage-extract
	cp -a squashfs-root/. .
	rm -rf squashfs-root
}

do_install() {
	vmkdir usr/lib/cinny
	vcopy AppRun usr/lib/cinny
	vcopy AppRun.wrapped usr/lib/cinny
	vcopy apprun-hooks usr/lib/cinny
	vcopy cinny.desktop usr/lib/cinny
	vcopy cinny.png usr/lib/cinny
	vcopy usr usr/lib/cinny
	chmod 755 ${DESTDIR}/usr/lib/cinny/AppRun
	chmod 755 ${DESTDIR}/usr/lib/cinny/AppRun.wrapped
	chmod 755 ${DESTDIR}/usr/lib/cinny/usr/bin/cinny
	find ${DESTDIR}/usr/lib/cinny -type f -perm -0002 -exec chmod o-w {} \;
	vbin ${FILESDIR}/cinny.sh cinny
	vinstall ${FILESDIR}/cinny.desktop 644 usr/share/applications
	for size in 32x32 128x128; do
		vinstall usr/share/icons/hicolor/${size}/apps/cinny.png 644 \
			usr/share/icons/hicolor/${size}/apps
	done
	vinstall usr/share/icons/hicolor/128x128/apps/cinny.png 644 usr/share/pixmaps cinny.png
	vlicense ${FILESDIR}/LICENSE
}
