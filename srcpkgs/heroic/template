# Template file for 'heroic'
pkgname=heroic
version=2.20.0
revision=1
archs="x86_64"
create_wrksrc=yes
depends="gtk+3 nss libXtst alsa-lib hicolor-icon-theme desktop-file-utils legendary-heroic"
short_desc="Open source launcher for GOG, Epic Games and Amazon Games"
maintainer="creations <creations@creations.works>"
license="GPL-3.0-or-later"
homepage="https://heroicgameslauncher.com"
distfiles="https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher/releases/download/v${version}/Heroic-${version}-linux-amd64.deb"
checksum=37737e8f9dcd2fd94b0bd4de6eb4d00834a1a3858c9fc9927c44fa1798c50cbd
nostrip=yes
allow_unknown_shlibs=yes

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/Heroic-${version}-linux-amd64.deb
	bsdtar -xf data.tar.xz
}

do_install() {
	vmkdir usr/lib/heroic
	vcopy "opt/Heroic/*" usr/lib/heroic
	chmod 755 ${DESTDIR}/usr/lib/heroic/heroic
	chmod 755 ${DESTDIR}/usr/lib/heroic/chrome_crashpad_handler
	vbin ${FILESDIR}/heroic.sh heroic
	vinstall ${FILESDIR}/heroic.desktop 644 usr/share/applications
	for size in 48 128 512; do
		vinstall usr/share/icons/hicolor/${size}x${size}/apps/heroic.png 644 \
			usr/share/icons/hicolor/${size}x${size}/apps
	done
	vinstall usr/share/icons/hicolor/128x128/apps/heroic.png 644 usr/share/pixmaps heroic.png
	vlicense ${FILESDIR}/LICENSE

	# Replace bundled PyInstaller legendary binary with system legendary.
	# The bundled binary embeds its own libpython3.14 which pollutes
	# LD_LIBRARY_PATH and breaks umu-launcher (and anything else using
	# the system Python that legendary spawns as a child process).
	rm -f ${DESTDIR}/usr/lib/heroic/resources/app.asar.unpacked/build/bin/x64/linux/legendary
	vinstall ${FILESDIR}/legendary-wrapper.sh 755 \
		usr/lib/heroic/resources/app.asar.unpacked/build/bin/x64/linux legendary
}
